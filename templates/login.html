{% extends "base.html" %}
{% block title %}Login{% endblock %}

{% block content %}
<div class="auth-container">
  <div class="auth-card">
    <h2>Login</h2>

    <form method="POST" action="{{ url_for('login') }}" class="auth-form">
      <!-- Email -->
      <div class="input-row">
        <span class="input-emoji">‚úâ</span>
        <input id="login_email" name="email" type="email" placeholder="Email" required>
      </div>

      <!-- Password -->
      <div class="input-row password-row">
        <span class="input-emoji">üîí</span>
        <input id="login_password" name="password" type="password" placeholder="Password" required>
        <button type="button" class="eye-btn" data-target="login_password">üëÅ</button>
      </div>

      <!-- Role -->
      <div class="input-row">
        <span class="input-emoji">üß©</span>
        <select id="login_role" name="role" required onchange="toggleSubRole()">
          <option value="" disabled selected>Select Role</option>
          {% for r in ROLES %}
            <option value="{{ r }}">{{ r }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Sub Role (hidden by default) -->
      <div class="input-row" id="subRoleDiv" style="display: none;">
        <span class="input-emoji">üîß</span>
        <select id="sub_role" name="sub_role">
          <option value="" disabled selected>Select Sub Role</option>
        </select>
      </div>

      <button type="submit" class="primary-btn">Login</button>

      <p class="small">New user? <a href="{{ url_for('register') }}">Register</a></p>
    </form>
  </div>
</div>

<script>
  const SUB_ROLES = {{ SUB_ROLES|tojson|safe }};

  function toggleSubRole() {
    const roleSelect = document.getElementById("login_role");
    const subRoleDiv = document.getElementById("subRoleDiv");
    const subRoleSelect = document.getElementById("sub_role");
    const selectedRole = roleSelect.value;

    subRoleSelect.innerHTML = '<option value="" disabled selected>Select Sub Role</option>';

    if (SUB_ROLES[selectedRole]) {
      subRoleDiv.style.display = "flex";
      SUB_ROLES[selectedRole].forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subRoleSelect.appendChild(opt);
      });
    } else {
      subRoleDiv.style.display = "none";
    }
  }
</script>

<!-- ‚úÖ Include JS for eye toggle -->
<script src="{{ url_for('static', filename='script.js') }}"></script>

{% endblock %}
