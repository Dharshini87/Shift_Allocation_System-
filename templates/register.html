{% extends "base.html" %}
{% block title %}Register{% endblock %}

{% block content %}
<div class="auth-container">
  <div class="auth-card">
    <h2>Create Account</h2>

    <form method="POST" action="{{ url_for('register') }}" class="auth-form">
      <!-- Name -->
      <div class="input-row">
        <span class="input-emoji">ğŸ‘¤</span>
        <input id="name" name="name" type="text" placeholder="Name" required>
      </div>

      <!-- Role -->
      <div class="input-row">
        <span class="input-emoji">ğŸ§©</span>
        <select id="role" name="role" required onchange="toggleSubRole()">
          <option value="" disabled selected>Select Role</option>
          {% for r in ROLES %}
            <option value="{{ r }}">{{ r }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Sub Role (hidden by default) -->
      <div class="input-row" id="subRoleDiv" style="display: none;">
        <span class="input-emoji">ğŸ”§</span>
        <select id="sub_role" name="sub_role">
          <option value="" disabled selected>Select Sub Role</option>
        </select>
      </div>

      <!-- Email -->
      <div class="input-row">
        <span class="input-emoji">âœ‰</span>
        <input id="email" name="email" type="email" placeholder="Email (@company.com)" required>
      </div>

      <!-- Password -->
      <div class="input-row password-row">
        <span class="input-emoji">ğŸ”’</span>
        <input id="reg_password" name="password" type="password" placeholder="Password" required>
        <button type="button" class="eye-btn" data-target="reg_password">ğŸ‘</button>
      </div>

      <!-- Confirm Password -->
      <div class="input-row password-row">
        <span class="input-emoji">ğŸ”’</span>
        <input id="reg_confirm" name="confirm_password" type="password" placeholder="Confirm Password" required>
        <button type="button" class="eye-btn" data-target="reg_confirm">ğŸ‘</button>
      </div>

      <button type="submit" class="primary-btn">Register</button>

      <p class="small">Already have an account?
        <a href="{{ url_for('login') }}">Login</a>
      </p>
    </form>
  </div>
</div>

<script>
  const SUB_ROLES = {{ SUB_ROLES | tojson }};

  function toggleSubRole() {
    const roleSelect = document.getElementById("role");
    const subRoleDiv = document.getElementById("subRoleDiv");
    const subRoleSelect = document.getElementById("sub_role");
    const selectedRole = roleSelect.value;

    subRoleSelect.innerHTML = '<option value="" disabled selected>Select Sub Role</option>';

    if (SUB_ROLES[selectedRole]) {
      subRoleDiv.style.display = "flex";
      SUB_ROLES[selectedRole].forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subRoleSelect.appendChild(opt);
      });
    } else {
      subRoleDiv.style.display = "none";
    }
  }
</script>

{% endblock %}
